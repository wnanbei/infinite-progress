## 一、FOREIGN KEY

外键本身是表中字段的约束条件，使用它可以将本表中的字段与其他表中的某个字段绑定起来，在这里简单称呼外键所在的表为子表，被绑定的表为父表，以示区分。

在使用外键绑定了两张表后，主要有两个效果：

- 在子表中写入数据时，如果这个数据在父表中不存在，则写入失败。
- 在父表中删除数据时，如果这条数据在子表中还存在绑定的数据，那么删除失败。

通过这种方式，外键便能够确保数据的一致性。

### 1. 外键优缺点

**优点**：

1. 能够在数据库层面保证数据的一致性，以免多个应用使用同一个数据库时，由于开发团队不同，造成数据不一致的问题。
2. 外键可以在一定层面上说明业务逻辑，是逻辑结构更加具体。

**缺点**：

1. 在数据库数据量以及吞吐量非常大时，使用外键会非常影响数据库性能。因为每一次插入或删除数据，都要去绑定的表中完整扫描一遍是否一致，这会极大影响效率。
2. 过多使用外键会提高开发难度，导致库中表过多的问题。

总结起来的话，在性能要求高的大型系统中，最好不要使用外键来保持一致性，而应该在应用层面单独写一个保护层来确保数据的一致性。

而在性能要求不高的其他情况，最好用外键来确保数据的一致性。

### 2. 使用方式

外键可以在建表时指定，也可以后续添加，首先是在建表的时候指定：

```mysql
create table tb_name1(
id int primary key auto_increment,
name varchar(10) not null,
class int,
[constraint 外键名] foreign key(class)　references tb_name2(字段名);
);
```

外键本身其实是有名字的，可以使用`constraint`在指定外键名，如果不指定的话，那么MySQL会默认给外键设置一个名字。

在`foreign key`后面跟着的是本表中要绑定的字段，`references`后面跟着的是要绑定的父表，括号中的是绑定的父表中的字段。

然后是已经创建好的表中添加外键：

```mysql
alter table tb_name1 add [constraint 外键名] foreign key(字段名) references tb_name2(字段名);
```

**注意事项**：

1. 首先，外键绑定的父表中的字段，必须至少是唯一键，在大多数情况会直接绑定主键，这也是为了确保数据的唯一性。
2. 绑定的父表中的字段，和子表中的字段，类型必须完全一致。
3. 在已经创建好的表中添加外键时，需要确保两张表中的数据一一对应。
4. 一张表中可以有多个外键。

## 二、表关系

通过外键，我们可以强制性的将表联系起来，两张表之间的关系可以大致分为三种：`一对一`，`一对多`，`多对多`。

### 1. 一对一

首先是一对一的关系，在外键的注意事项我们说过，绑定的父表中字段，必须至少是唯一键。那么在此基础之上，如果子表中的绑定字段，也是唯一的字段，则可以称两张表形成了一对一的表关系。

也就是父表中的绑定字段，与子表中的绑定字段，只可能出现一一对应的情况。

### 2. 一对多

使用默认的一般外键建立的表关系，就是一对多。因为父表中的字段是唯一的，子表中的字段则可以重复，说明可以出现父表中的一条数据对应子表中多条数据的情况，这就是所谓的一对多表关系。

### 3. 多对多

最后是多对多的表关系，相对于上两种表关系，多对多要复杂许多。因为受父表中的字段必须是唯一的这个条件限制，一般的外键是无法实现多对多关系的，这个时候就需要使用一个特殊方式：中间表。

所谓的中间表则是指专门创建一张表，这张表用来记录父表和子表之间的数据对应关系。

具体的方式是创建两个字段，将这两个字段分别用外键绑定到父表和子表上，然后再将这两个字段设定为联合主键。联合主键的作用是确保对应关系不会发生重复的情况。