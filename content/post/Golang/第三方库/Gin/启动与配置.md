---
title: "Gin 启动与配置"
description: 
date: 2020-08-05 00:00:00
categories:
  - Go第三方库
tags:
  - Go
  - Gin
series:	
  - Go Web 开发
---

Gin 的安装、启动、配置与部分简介。

<!--more-->

## 安装

安装：

```bash
$ go get -u github.com/gin-gonic/gin
```

导入：

```go
import "github.com/gin-gonic/gin"
```

简单例子：

```go
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // 默认监听并在 0.0.0.0:8080 上启动服务
}
```

## 启动

### 创建路由

通常情况下使用 `gin.Default()` 方法获取 gin 实例，但此方法获取的引擎默认使用两个中间件 Logger 和 Recovery。

```go
r := gin.Default()
```

如果希望使用无中间件的实例，使用以下方法：

```go
r := gin.New()
```

### 自定义 HTTP 配置

直接使用 `http.ListenAndServe()` ：

```go
func main() {
	router := gin.Default()
	http.ListenAndServe(":8080", router)
}
```

或者

```go
func main() {
	router := gin.Default()

	s := &http.Server{
		Addr:           ":8080",
		Handler:        router,
		ReadTimeout:    10 * time.Second,
		WriteTimeout:   10 * time.Second,
		MaxHeaderBytes: 1 << 20,
	}
	s.ListenAndServe()
}
```

### 运行多个服务

```go
package main

import (
	"log"
	"net/http"
	"time"

	"github.com/gin-gonic/gin"
	"golang.org/x/sync/errgroup"
)

var (
	g errgroup.Group
)

func router01() http.Handler {
	e := gin.New()
	e.Use(gin.Recovery())
	e.GET("/", func(c *gin.Context) {
		c.JSON(
			http.StatusOK,
			gin.H{
				"code":  http.StatusOK,
				"error": "Welcome server 01",
			},
		)
	})

	return e
}

func router02() http.Handler {
	e := gin.New()
	e.Use(gin.Recovery())
	e.GET("/", func(c *gin.Context) {
		c.JSON(
			http.StatusOK,
			gin.H{
				"code":  http.StatusOK,
				"error": "Welcome server 02",
			},
		)
	})

	return e
}

func main() {
	server01 := &http.Server{
		Addr:         ":8080",
		Handler:      router01(),
		ReadTimeout:  5 * time.Second,
		WriteTimeout: 10 * time.Second,
	}

	server02 := &http.Server{
		Addr:         ":8081",
		Handler:      router02(),
		ReadTimeout:  5 * time.Second,
		WriteTimeout: 10 * time.Second,
	}

	g.Go(func() error {
		return server01.ListenAndServe()
	})

	g.Go(func() error {
		return server02.ListenAndServe()
	})

	if err := g.Wait(); err != nil {
		log.Fatal(err)
	}
}
```
