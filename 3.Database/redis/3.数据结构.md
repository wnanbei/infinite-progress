在 Redis 中，常用的 5 种数据类型和应用场景如下：

- `String`：缓存、计数器、分布式锁等。
- `List`：链表、队列、微博关注人时间轴列表等。
- `Hash`： 用户信息、Hash 表等。
- `Set`： 去重、赞、踩、共同好友等。
- `Zset`：访问量排行榜、点击量排行榜等。

不同数据类型使用不同的数据结构以提升速度。每种数据类型都有一种或者多种数据结构来支撑，底层数据结构有 6 种。

![Redis底层数据结构类型](../../assets/Redis%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B.webp)

使用以下命令可以查看 Key 具体的编码方式：

```redis
> object encoding key
```

## 全局 Hash 表

Redis 整体由一个哈希表来保存所有的键值对，无论数据类型是 5 种的任意一种。

哈希表本质是一个数组，每个元素被叫做哈希桶，不管什么数据类型，每个桶里面的 `entry` 保存着实际具体值的指针。

哈希表的时间复杂度是 O(1)。

<img src="../../assets/Redis%E5%85%A8%E5%B1%80Hash%E8%A1%A8.webp" alt="Redis全局Hash表" style="zoom:90%;" />

### 1. 哈希冲突

Redis 通过`链式哈希`解决冲突：**也就是同一个桶里面的元素使用链表保存**。

但是当链表过长就会导致查找性能变差可能，所以 Redis 为了追求快，使用了两个全局哈希表。用于 rehash 操作，增加现有的哈希桶数量，减少哈希冲突。

开始默认使用哈希表 1 保存键值对数据，哈希表 2 此刻没有分配空间。当数据越来多触发 rehash 操作，则执行以下操作：

1. 给哈希表 2 分配更大的空间
2. 将哈希表 1 的数据重新映射拷贝到哈希表 2 中
3. 释放哈希表 1 的空间

### 2. 渐进式 Rehash

将哈希表 1 的数据重新映射到哈希表 2 的过程中并不是一次性的，这样会造成 Redis 阻塞，无法提供服务。

Redis 采用了渐进式 rehash，每次处理客户端请求的时候，先从哈希表 1 中第一个索引开始，将这个位置的所有数据拷贝到哈希表 2 中，就这样将 rehash 分散到多次请求过程中，避免耗时阻塞。

## 数据结构

### redisObject

### SDS 动态字符串

### HashTable